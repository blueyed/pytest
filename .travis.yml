language: python
dist: trusty
python: '3.5.1'
cache: false

env:
  global:
    - PIP_DISABLE_PIP_VERSION_CHECK=1
    - CODECOV_FLAGS=Travis,Linux
    - COLUMNS=130

# setuptools-scm needs all tags in order to obtain a proper version
git:
  depth: false

install:
  - python -m pip install git+https://github.com/blueyed/tox@master

jobs:
  include:
    # Coverage for Python 3.5.{0,1} specific code, mostly typing related.
    - env:
        - TOXENV=py35-coverage
        - PYTEST_ADDOPTS="-ra --durations=50 -m 'py35_specific or acceptance_tests'"
      before_install:
        - python -m pip install -U pip==19.3.1
        # Work around https://github.com/jaraco/zipp/issues/40.
        - python -m pip install -U 'setuptools>=34.4.0' virtualenv==16.7.9

before_script:
  - python -m tox --notest -v --durations

script:
  - env CODECOV_NAME="$TRAVIS_OS_NAME-$TOXENV" python -m tox -v --durations

branches:
  only:
    - my-master
    - /^\d+\.\d+\.x$/
